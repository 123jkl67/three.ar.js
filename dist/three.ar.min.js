/*
 * Copyright 2017 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


!function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadBlocksModel=t.getARDisplay=t.isARDisplay=t.isARKit=t.isTango=void 0;var i=r(7);THREE.ARUtils=Object.create(null),THREE.ARUtils.isTango=function(e){return e&&e.displayName.toLowerCase().includes("tango")};var n=t.isTango=THREE.ARUtils.isTango;THREE.ARUtils.isARKit=function(e){return e&&e.displayName.toLowerCase().includes("arkit")};var o=t.isARKit=THREE.ARUtils.isARKit;THREE.ARUtils.isARDisplay=function(e){return o(e)||n(e)};var a=t.isARDisplay=THREE.ARUtils.isARDisplay;THREE.ARUtils.getARDisplay=function(){return new Promise(function(e,t){if(!navigator.getVRDisplays)return void e(null);navigator.getVRDisplays().then(function(t){if(!t&&0===t.length)return void e(null);var r=!0,i=!1,n=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;if(a(u))return void e(u)}}catch(e){i=!0,n=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw n}}e(null)})})};t.getARDisplay=THREE.ARUtils.getARDisplay;THREE.ARUtils.loadBlocksModel=function(e,t){return new Promise(function(r,n){if(!THREE.OBJLoader||!THREE.MTLLoader)return void n(new Error("Must include THREE.OBJLoader and THREE.MTLLoader"));var o=Promise.resolve();t&&(o=(0,i.loadMtl)(t)),o.then(function(t){return t&&t.preload(),(0,i.loadObj)(e,t)}).then(function(e){var t=e.children[0];return t.geometry.applyMatrix((new THREE.Matrix4).makeRotationY(THREE.Math.degToRad(-90))),t}).then(r,n)})};t.loadBlocksModel=THREE.ARUtils.loadBlocksModel},function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,r,i)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(i)},u=void 0,l=function(e){function t(e,r,o,a,s){i(this,t);var u=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,o,a,s));return u.isARPerpsectiveCamera=!0,u.vrDisplay=e,u.updateProjectionMatrix(),e&&e.capabilities.hasPassThroughCamera||console.warn("ARPerspectiveCamera does not a VRDisplay with\n                    a pass through camera. Using supplied values and defaults\n                    instead of device camera intrinsics"),u}return o(t,e),a(t,[{key:"updateProjectionMatrix",value:function(){var e=this.getProjectionMatrix();if(!e)return void s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateProjectionMatrix",this).call(this);this.projectionMatrix.fromArray(e)}},{key:"getProjectionMatrix",value:function(){return this.vrDisplay&&this.vrDisplay.getFrameData?(u||(u=new VRFrameData),this.vrDisplay.getFrameData(u),u.leftProjectionMatrix):null}}]),t}(THREE.PerspectiveCamera);THREE.ARPerspectiveCamera=l,t.default=l},function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=new THREE.Vector3,u=new THREE.Vector3,l=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.025,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.03,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16711799,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.25;i(this,t);var u=new THREE.RingGeometry(r,o,36,64),l=new THREE.MeshBasicMaterial({color:a}),c=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,u,l));return c.easing=s,c.vrDisplay=e,c._planeDir=new THREE.Vector3,c}return o(t,e),a(t,[{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;if(this.vrDisplay&&this.vrDisplay.hitTest){var r=this.vrDisplay.hitTest(e,t);if(r){var i=r.point,n=r.plane;s.fromArray(i),this.position.lerp(s,this.easing),u.fromArray(n),this._planeDir.lerp(u,this.easing),s.addVectors(this._planeDir,this.position),this.lookAt(s)}}}}]),t}(THREE.Mesh);THREE.ARReticle=l,t.default=l},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t,r){var i;if("fragment"==r)i=e.createShader(e.FRAGMENT_SHADER);else{if("vertex"!=r)return null;i=e.createShader(e.VERTEX_SHADER)}return e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(alert(e.getShaderInfoLog(i)),null)}function a(e,t,r){var i=o(e,t,"vertex"),n=o(e,r,"fragment");if(!n)return null;var a=e.createProgram();return e.attachShader(a,i),e.attachShader(a,n),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS)||alert("Could not initialise arview shaders"),a}function s(e,t){var r=0;switch(t){case 90:r=1;break;case 180:r=2;break;case 270:r=3;break;default:r=0}var i=0;switch(e){case 90:i=1;break;case 180:i=2;break;case 270:i=3;break;default:i=0}var n=i-r;return n<0&&(n+=4),n%4}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r(0),c=r(5),f=i(c),h=r(4),d=i(h),p=function(){function e(t,r){n(this,e),this.vrDisplay=t,this.gl=r,this.vrDisplay&&(this.passThroughCamera=t.getPassThroughCamera(),this.program=a(r,f.default,d.default)),r.useProgram(this.program),this.vertexPositionAttribute=r.getAttribLocation(this.program,"aVertexPosition"),this.textureCoordAttribute=r.getAttribLocation(this.program,"aTextureCoord"),this.samplerUniform=r.getUniformLocation(this.program,"uSampler"),this.vertexPositionBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.vertexPositionBuffer);var i=[-1,1,0,-1,-1,0,1,1,0,1,-1,0],o=new Float32Array(i);r.bufferData(r.ARRAY_BUFFER,o,r.STATIC_DRAW),this.vertexPositionBuffer.itemSize=3,this.vertexPositionBuffer.numItems=12,this.textureCoordBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.textureCoordBuffer);var u=null;if(this.vrDisplay){var l=this.passThroughCamera.width/this.passThroughCamera.textureWidth,c=this.passThroughCamera.height/this.passThroughCamera.textureHeight;u=[[0,0,0,c,l,0,l,c],[l,0,0,0,l,c,0,c],[l,c,l,0,0,c,0,0],[0,c,l,c,0,0,l,0]]}else u=[[0,0,0,1,1,0,1,1],[1,0,0,0,1,1,0,1],[1,1,1,0,0,1,0,0],[0,1,1,1,0,0,1,0]];this.f32TextureCoords=[];for(var h=0;h<u.length;h++)this.f32TextureCoords.push(new Float32Array(u[h]));this.combinedOrientation=s(screen.orientation.angle,this.passThroughCamera.orientation),r.bufferData(r.ARRAY_BUFFER,this.f32TextureCoords[this.combinedOrientation],r.STATIC_DRAW),this.textureCoordBuffer.itemSize=2,this.textureCoordBuffer.numItems=8,r.bindBuffer(r.ARRAY_BUFFER,null),this.indexBuffer=r.createBuffer(),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var p=[0,1,2,2,1,3],v=new Uint16Array(p);return r.bufferData(r.ELEMENT_ARRAY_BUFFER,v,r.STATIC_DRAW),this.indexBuffer.itemSize=1,this.indexBuffer.numItems=6,r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null),this.texture=r.createTexture(),r.useProgram(null),this.projectionMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.mvMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this}return u(e,[{key:"render",value:function(){var e=this.gl;e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.vertexPositionBuffer),e.enableVertexAttribArray(this.vertexPositionAttribute),e.vertexAttribPointer(this.vertexPositionAttribute,this.vertexPositionBuffer.itemSize,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.textureCoordBuffer);var t=s(screen.orientation.angle,this.passThroughCamera.orientation);t!==this.combinedOrientation&&(this.combinedOrientation=t,e.bufferData(e.ARRAY_BUFFER,this.f32TextureCoords[this.combinedOrientation],e.STATIC_DRAW)),e.enableVertexAttribArray(this.textureCoordAttribute),e.vertexAttribPointer(this.textureCoordAttribute,this.textureCoordBuffer.itemSize,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_EXTERNAL_OES,this.texture),e.texImage2D(e.TEXTURE_EXTERNAL_OES,0,e.RGB,e.RGB,e.UNSIGNED_BYTE,this.passThroughCamera),e.uniform1i(this.samplerUniform,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.drawElements(e.TRIANGLES,this.indexBuffer.numItems,e.UNSIGNED_SHORT,0),e.bindTexture(e.TEXTURE_EXTERNAL_OES,null),e.disableVertexAttribArray(this.vertexPositionAttribute),e.disableVertexAttribArray(this.textureCoordAttribute),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.useProgram(null)}}]),e}(),v=function(){function e(t,r){n(this,e),this.vrDisplay=t,(0,l.isARKit)(this.vrDisplay)||(this.renderer=r,this.gl=r.context,this.videoRenderer=new p(t,this.gl),this.renderer.resetGLState())}return u(e,[{key:"render",value:function(){if(!(0,l.isARKit)(this.vrDisplay)){var e=this.gl,t=window.devicePixelRatio,r=window.innerWidth*t,i=window.innerHeight*t;e.viewportWidth!==r&&(e.viewportWidth=r),e.viewportHeight!==i&&(e.viewportHeight=i),this.gl.viewport(0,0,e.viewportWidth,e.viewportHeight),this.videoRenderer.render(),this.renderer.resetGLState()}}}]),e}();THREE.ARView=v,t.default=v},function(e,t,r){"use strict";e.exports="// Copyright 2017 Google Inc. All Rights Reserved.\n// Licensed under the Apache License, Version 2.0 (the 'License');\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an 'AS IS' BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n#extension GL_OES_EGL_image_external : require\n\nprecision mediump float;\n#define GLSLIFY 1\n\nvarying vec2 vTextureCoord;\n\nuniform samplerExternalOES uSampler;\n\nvoid main(void) {\n  gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"},function(e,t,r){"use strict";e.exports="#define GLSLIFY 1\n// Copyright 2017 Google Inc. All Rights Reserved.\n// Licensed under the Apache License, Version 2.0 (the 'License');\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an 'AS IS' BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  gl_Position = vec4(aVertexPosition, 1.0);\n  vTextureCoord = aTextureCoord;\n}\n"},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var n=r(1),o=(i(n),r(2)),a=(i(o),r(0)),s=(i(a),r(3));i(s)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){};t.loadObj=function(e,t){return new Promise(function(r,n){var o=new THREE.OBJLoader;t&&o.setMaterials(t),o.load(e,r,i,n)})},t.loadMtl=function(e){return new Promise(function(t,r){var n=new THREE.MTLLoader,o=e.split("/");o.length>=2&&n.setTexturePath(o[o.length-2]),n.load(e,t,i,r)})}}]);